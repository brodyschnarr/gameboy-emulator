<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chart Test</title>
    <style>
        body {
            font-family: system-ui;
            padding: 20px;
            background: #f9fafb;
        }
        .card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #projection-chart {
            width: 100%;
            height: 400px;
            display: block;
            border: 2px solid #2563eb;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Simple Chart Test</h1>
    <p>This tests if basic canvas drawing works at all.</p>
    
    <button onclick="testBasicDraw()">Test 1: Basic Draw (No Hide)</button>
    <button onclick="testDrawAfterShow()">Test 2: Draw After Show</button>
    <button onclick="testDrawWithRAF()">Test 3: Draw With requestAnimationFrame</button>
    
    <div id="results" class="hidden">
        <div class="card">
            <h2>ðŸ“ˆ Portfolio Projection</h2>
            <canvas id="projection-chart"></canvas>
        </div>
    </div>
    
    <div id="log" style="margin-top: 20px; padding: 10px; background: #1f2937; color: #10b981; font-family: monospace; font-size: 12px;"></div>

    <script>
        function log(msg) {
            const div = document.getElementById('log');
            div.innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        function drawSimpleChart() {
            log('ðŸŽ¨ Starting to draw chart...');
            
            const canvas = document.getElementById('projection-chart');
            if (!canvas) {
                log('âŒ Canvas not found!');
                return;
            }
            log('âœ… Canvas found');
            
            const container = canvas.parentElement;
            log(`Container offsetWidth: ${container.offsetWidth}px`);
            
            const containerWidth = Math.max(container.offsetWidth - 40, 300);
            canvas.width = containerWidth;
            canvas.height = 400;
            
            log(`Canvas dimensions: ${canvas.width} x ${canvas.height}`);
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                log('âŒ Cannot get 2D context!');
                return;
            }
            log('âœ… Got 2D context');
            
            const w = canvas.width;
            const h = canvas.height;
            const padding = 60;
            
            // Clear
            ctx.clearRect(0, 0, w, h);
            
            // Background
            ctx.fillStyle = '#f9fafb';
            ctx.fillRect(0, 0, w, h);
            log('âœ… Drew background');
            
            // Axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, h - padding);
            ctx.stroke();
            log('âœ… Drew axes');
            
            // Test line (diagonal)
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(w - padding, padding);
            ctx.stroke();
            log('âœ… Drew test line');
            
            // Text
            ctx.fillStyle = '#111827';
            ctx.font = '20px sans-serif';
            ctx.fillText('TEST CHART', w / 2 - 60, h / 2);
            log('âœ… Drew text');
            
            // Check if pixels were drawn
            const imageData = ctx.getImageData(0, 0, 10, 10);
            const hasPixels = imageData.data.some(p => p !== 0);
            log(`Pixels drawn: ${hasPixels ? 'YES' : 'NO'}`);
            
            log('ðŸŽ‰ Chart drawing complete!');
        }
        
        function testBasicDraw() {
            document.getElementById('log').innerHTML = '';
            log('TEST 1: Basic draw (results already visible)');
            log('â”€'.repeat(60));
            
            // Make results visible first
            document.getElementById('results').classList.remove('hidden');
            
            // Draw immediately
            drawSimpleChart();
        }
        
        function testDrawAfterShow() {
            document.getElementById('log').innerHTML = '';
            log('TEST 2: Draw after showing (simulates app.js timing fix)');
            log('â”€'.repeat(60));
            
            // Hide first
            document.getElementById('results').classList.add('hidden');
            log('Results hidden');
            
            // Show
            setTimeout(() => {
                log('Making results visible...');
                document.getElementById('results').classList.remove('hidden');
                
                // Draw after small delay
                setTimeout(() => {
                    drawSimpleChart();
                }, 100);
            }, 500);
        }
        
        function testDrawWithRAF() {
            document.getElementById('log').innerHTML = '';
            log('TEST 3: Draw with requestAnimationFrame');
            log('â”€'.repeat(60));
            
            // Hide first
            document.getElementById('results').classList.add('hidden');
            log('Results hidden');
            
            // Show
            log('Making results visible...');
            document.getElementById('results').classList.remove('hidden');
            
            // Draw with RAF
            requestAnimationFrame(() => {
                log('requestAnimationFrame fired');
                drawSimpleChart();
            });
        }
    </script>
</body>
</html>
